<!DOCTYPE html>
<html lang='zh'>
    <head>
	<meta name="generator" content="Hugo 0.152.2"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="utf-8">
<i class="dark hidden"></i>
<title>
  
    结痂行会
  
</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="icon" href='/favicon-32x32.png'>


<link rel="stylesheet" href="/css/style.css">

<link href='/css/style.min.css' rel="stylesheet" type="text/css">
        
        <link rel="stylesheet" href="/css/main.css">
        
    </head>
    
    
    <body class="flex flex-col min-h-screen bg-flora dark:bg-warmgray-800">
    <header class="bg-rose text-white dark:bg-warmgray-900 dark:text-white" style="font-family: 'title'">
    <nav class="flex items-center justify-between flex-wrap p-4">
        <div class="flex items-center flex-shrink-0 text-2xl mx-6">
          
            <a href="http://localhost:1313/"><img src="/img/logo.webp" class="w-24 h-auto" /></a>
          
        </div>
        <div class="flex items-center">
            
            <div class="hidden md:block mr-4">
                
            </div>
            
            <button id="theme-toggle" class="focus:outline-none p-2" aria-label="切换日间/夜间模式">
                <i class="icon-moon text-xl" id="theme-icon"></i>
            </button>
        </div>
    </nav>
</header>

<script>

document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    
    
    const getCurrentTheme = () => {
        if (localStorage.getItem('theme')) {
            return localStorage.getItem('theme');
        }
        return document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    };
    
    
    const initTheme = () => {
        const currentTheme = getCurrentTheme();
        if (currentTheme === 'dark') {
            document.documentElement.classList.add('dark');
            themeIcon.classList.remove('icon-moon');
            themeIcon.classList.add('icon-sun'); 
        } else {
            document.documentElement.classList.remove('dark');
            themeIcon.classList.remove('icon-sun');
            themeIcon.classList.add('icon-moon');
        }
    };
    
    
    const toggleTheme = () => {
        const currentTheme = getCurrentTheme();
        if (currentTheme === 'dark') {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('theme', 'light');
            themeIcon.classList.remove('icon-sun');
            themeIcon.classList.add('icon-moon');
        } else {
            document.documentElement.classList.add('dark');
            localStorage.setItem('theme', 'dark');
            themeIcon.classList.remove('icon-moon');
            themeIcon.classList.add('icon-sun');
        }
    };
    
    
    initTheme();
    
    
    if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
    }
    
    
    window.toggleDarkMode = toggleTheme;
});
</script><div class="container mx-auto max-w-7xl my-4 flex-grow" id="content">
<h2 class="text-4xl py-3 dark:text-white"></h2>





  
  
  
  
    
    
      
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
      
    
  
    
    
  
    
    
      
    
  
    
    
      
    
  
    
    
  
    
    
  
    
    
      
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  

  
  
    
    
      
      
        
      
    
  
    
    
      
      
        
      
    
  
    
    
      
      
        
      
    
  
    
    
      
      
        
      
    
  
    
    
      
      
        
      
    
  
  
  
  







<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  
    
      <div class="border-b dark:border-warmgray-700">
        
          







  
  
  
  




 


  
  
  
  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
  
  
  
  
  
  
    
      
      
  
  
  
  
  
  
  
  





  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  





 






<article class="p-6 dark:text-white lg:flex">
    <a href="http://localhost:1313/posts/lore/1/" aria-label="Read">
        
        
        
        
        
        <img class="mx-auto w-24 h-32 lg:mx-0 mb-5 object-cover lg:mb-0" src="/img/1.webp" alt="thumbnail" />
        
    </a>
    <div class="lg:ml-8 text-center md:text-left">
        <a href="http://localhost:1313/posts/lore/1/">
            <h1 class="text-xl mb-2">世界辞书</h1>
        </a>
        <p class="mb-3 text-xs opacity-70">2898字 · 10章</p>
        
        
        
        
          
        
        
            <div id="tags">
                
                <span class="inline-flex my-2 mr-2 leading-4 mb-2 content-center justify-center h-8 text-blue-600">
                    <a href="http://localhost:1313/tags/%E4%B8%96%E7%95%8C%E8%A7%82">#世界观</a>
                </span>
                
            </div>
        
        
        <p class="text-sm opacity-70">
          
            藏书馆所收录的部分条目。
          
        </p>
    </div>
</article>
        
      </div>
    
  
    
      <div class="border-b dark:border-warmgray-700">
        
          







  
  
  
  




 


  
  
  
  
  
  
  
    
      
    
  
    
      
    
  
  
  
  
  
  
  
    
      
      
  
  
  
    
  
  
  
  
  
  





  
    
  
    
  





 






<article class="p-6 dark:text-white lg:flex">
    <a href="http://localhost:1313/posts/game/aurum/" aria-label="Read">
        
        
        
        
        
        <img class="mx-auto w-24 h-32 lg:mx-0 mb-5 object-cover lg:mb-0" src="/img/2.webp" alt="thumbnail" />
        
    </a>
    <div class="lg:ml-8 text-center md:text-left">
        <a href="http://localhost:1313/posts/game/aurum/">
            <h1 class="text-xl mb-2">化石与金属</h1>
        </a>
        <p class="mb-3 text-xs opacity-70">252字 · 2章</p>
        
        
        
        
          
        
        
            <div id="tags">
                
                <span class="inline-flex my-2 mr-2 leading-4 mb-2 content-center justify-center h-8 text-blue-600">
                    <a href="http://localhost:1313/tags/%E6%B8%B8%E6%88%8F">#游戏</a>
                </span>
                
            </div>
        
        
        <p class="text-sm opacity-70">
          
            衍生游戏合集，可在网页端游玩。
          
        </p>
    </div>
</article>
        
      </div>
    
  
    
      <div class="border-b dark:border-warmgray-700">
        
          







  
  
  
  




 


  
  
  
  
  
  
  
    
      
    
  
  
  
  
  
  
  
    
      
      
  
  
  
    
  
  
  
  
  
  





  
    
  





 






<article class="p-6 dark:text-white lg:flex">
    <a href="http://localhost:1313/posts/tales/1/" aria-label="Read">
        
        
        
        
        
        <img class="mx-auto w-24 h-32 lg:mx-0 mb-5 object-cover lg:mb-0" src="/img/4.webp" alt="thumbnail" />
        
    </a>
    <div class="lg:ml-8 text-center md:text-left">
        <a href="http://localhost:1313/posts/tales/1/">
            <h1 class="text-xl mb-2">胃酸故事集</h1>
        </a>
        <p class="mb-3 text-xs opacity-70">9290字 · 1章</p>
        
        
        
        
          
        
        
            <div id="tags">
                
                <span class="inline-flex my-2 mr-2 leading-4 mb-2 content-center justify-center h-8 text-blue-600">
                    <a href="http://localhost:1313/tags/%E5%B0%8F%E8%AF%B4">#小说</a>
                </span>
                
                <span class="inline-flex my-2 mr-2 leading-4 mb-2 content-center justify-center h-8 text-blue-600">
                    <a href="http://localhost:1313/tags/%E7%9F%AD%E7%AF%87">#短篇</a>
                </span>
                
            </div>
        
        
        <p class="text-sm opacity-70">
          
            睡前故事、教化寓言与精怪传说。
          
        </p>
    </div>
</article>
        
      </div>
    
  
    
      <div class="border-b dark:border-warmgray-700">
        
          







  
  
  
  




 


  
  
  
  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
  
  
  
  
  
  
    
      
      
  
  
  
  
  
  
  
  





  
    
  
    
  
    
  
    
  





 






<article class="p-6 dark:text-white lg:flex">
    <a href="http://localhost:1313/posts/chuanghai/1/" aria-label="Read">
        
        
        
        
        
        <img class="mx-auto w-24 h-32 lg:mx-0 mb-5 object-cover lg:mb-0" src="/img/3.webp" alt="thumbnail" />
        
    </a>
    <div class="lg:ml-8 text-center md:text-left">
        <a href="http://localhost:1313/posts/chuanghai/1/">
            <h1 class="text-xl mb-2">疮海无穷谭</h1>
        </a>
        <p class="mb-3 text-xs opacity-70">24369字 · 4章</p>
        
        
        
        
          
        
        
            <div id="tags">
                
                <span class="inline-flex my-2 mr-2 leading-4 mb-2 content-center justify-center h-8 text-blue-600">
                    <a href="http://localhost:1313/tags/%E5%B0%8F%E8%AF%B4">#小说</a>
                </span>
                
                <span class="inline-flex my-2 mr-2 leading-4 mb-2 content-center justify-center h-8 text-blue-600">
                    <a href="http://localhost:1313/tags/%E6%9C%AA%E5%AE%8C%E7%BB%93">#未完结</a>
                </span>
                
            </div>
        
        
        <p class="text-sm opacity-70">
          
            从诗岛前往世界起点的航海纪事。
          
        </p>
    </div>
</article>
        
      </div>
    
  
    
      <div class="border-b dark:border-warmgray-700">
        
          







  
  
  
  




 


  
  
  
  
  
  
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
  
  
  
  
  
  
    
      
      
  
  
  
  
  
  
  
  





  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  





 






<article class="p-6 dark:text-white lg:flex">
    <a href="http://localhost:1313/posts/character/1/" aria-label="Read">
        
        
        
        
        
        <img class="mx-auto w-24 h-32 lg:mx-0 mb-5 object-cover lg:mb-0" src="/img/5.webp" alt="thumbnail" />
        
    </a>
    <div class="lg:ml-8 text-center md:text-left">
        <a href="http://localhost:1313/posts/character/1/">
            <h1 class="text-xl mb-2">面孔收录</h1>
        </a>
        <p class="mb-3 text-xs opacity-70">521字 · 10章</p>
        
        
        
        
          
        
        
            <div id="tags">
                
                <span class="inline-flex my-2 mr-2 leading-4 mb-2 content-center justify-center h-8 text-blue-600">
                    <a href="http://localhost:1313/tags/%E8%A7%92%E8%89%B2">#角色</a>
                </span>
                
            </div>
        
        
        <p class="text-sm opacity-70">
          
            可能出现在故事中的部分面孔。
          
        </p>
    </div>
</article>
        
      </div>
    
  
  
  
    
    
      <div class="border-b dark:border-warmgray-700">
        
<div class="v-tarot-minimal border-b dark:border-warmgray-700 bg-gray-50 dark:bg-warmgray-800" aria-live="polite">
  <div class="v-main">
    
    <div id="v-tarot-card" class="v-card" role="button" tabindex="0" aria-label="塔罗牌 — 点击抽取">
      <div class="v-card-inner" aria-hidden="true">
        <div class="v-face v-face-back">
          <div class="v-sigil">✶</div>
        </div>

        <div class="v-face v-face-front" id="v-card-front">
          <div class="v-card-content">
            <div id="v-card-name" class="v-card-name text-xs font-bold">点击抽牌</div>
            <div id="v-card-meaning" class="v-card-meaning text-xs text-white dark:text-gray-200">每日一则简短指引</div>
          </div>
        </div>
      </div>
    </div>

    
    <div class="v-controls-right">
      <div id="v-title" class="v-title text-xl dark:text-white mb-2">每日塔罗</div>
      <button id="v-draw-btn" class="v-btn text-base dark:text-white" type="button">抽取今日塔罗</button>
      
      <div id="v-meta" class="v-meta text-xs text-gray-600 dark:text-gray-300 mt-2">
        <div id="v-meta-result"></div>
        <div id="v-meta-next" style="margin-top:4px;"></div>
      </div>
    </div>
  </div>
</div>

<style>
 
.v-tarot-minimal {
  font-family: inherit;
  padding: 1.5rem;  
  margin-top: 0;
  background: transparent;
  border: none;
  color: inherit;
  box-shadow: none;
  width: 100%;
  box-sizing: border-box;
  transition: background-color 200ms, border-color 200ms;
}

 
.v-main {
  display: flex;
  gap: 1.5rem;
  justify-content: flex-start;
  align-items: flex-start;  
  flex-wrap: wrap;
  width: 100%;
  min-height: 128px;  
}

 
.v-card {
  width: 6rem;  
  height: 8rem;  
  perspective: 600px;
  cursor: pointer;
  user-select: none;
  position: relative;
  flex: 0 0 auto;
  -webkit-tap-highlight-color: transparent;
  transition: transform 100ms;
}

.v-card:hover {
  transform: translateY(-1px);
}

.v-card-inner {
  width: 100%;
  height: 100%;
  border-radius: 0.25rem;
  transform-style: preserve-3d;
  transition: transform 520ms cubic-bezier(.22,.9,.25,1);
  box-shadow: none;
  position: relative;
  background: transparent;
  border: 1px solid rgba(0,0,0,0.08);
}

.dark .v-card-inner {
  border: 1px solid rgba(255,255,255,0.1);
}

.v-card.is-flipped .v-card-inner {
  transform: rotateY(180deg);
}

.v-face {
  position: absolute;
  inset: 0;
  border-radius: 0.25rem;  
  backface-visibility: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  padding: 8px;
}

.v-face-back {
  background: linear-gradient(180deg, #d1cfcb 0%, #964848 100%);
  border: 1px solid rgba(0,0,0,0.04);
  color: inherit;
  display: flex;
  align-items: center;
  justify-content: center;
}

.dark .v-face-back {
  background: linear-gradient(180deg, #1f1f1f 0%, #964848 100%);
  border: 1px solid rgba(255,255,255,0.08);
}

.v-sigil {
  font-size: 18px;
  line-height: 1;
  color: rgba(0,0,0,0.5);
  opacity: 0.9;
}

.dark .v-sigil {
  color: rgba(255,255,255,0.6);
}

.v-face-front {
  transform: rotateY(180deg);
  background: #964848;
  padding: 12px;
  text-align: center;
  color: inherit;
  border: 1px solid rgba(0,0,0,0.06);
}

.dark .v-face-front {
  background: #964848;
  border: 1px solid rgba(255,255,255,0.08);
}

 
.v-card-name {
  margin-bottom: 6px;
  letter-spacing: 0.01em;
  font-weight: 700;
  text-align: center;
  color: inherit;
  font-size: 0.75rem;  
  line-height: 1.2;
}

.v-card-meaning {
  font-weight: 500;
  line-height: 1.3;
  max-height: 4.5em;
  overflow: hidden;
  text-align: center;
  padding-top: 4px;
  border-top: 1px dashed rgba(0,0,0,0.06);
  font-size: 0.7rem;  
}

.dark .v-card-meaning {
  color: rgba(255,255,255,0.8);
  border-top: 1px dashed rgba(255,255,255,0.06);
}

 
.v-controls-right {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  align-items: flex-start;
  min-width: 160px;
  flex: 1;
}

 
.v-title {
  margin-bottom: 0.5rem;
  margin-top: 0;  
  color: inherit;
  opacity: 0.95;
}

 
.v-btn {
  appearance: none;
  background: transparent;
  border: 1px solid rgba(0,0,0,0.15);
  padding: 0.375rem 0.75rem;
  border-radius: 0.125rem;  
  color: inherit;
  font-weight: 600;
  cursor: pointer;
  box-shadow: none;  
  transition: background-color 150ms, border-color 150ms;
  font-size: 0.75rem;  
}

.dark .v-btn {
  border: 1px solid rgba(255,255,255,0.25);
}

.v-btn:hover {
  background: rgba(0,0,0,0.04);
}

.dark .v-btn:hover {
  background: rgba(255,255,255,0.08);
}

.v-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

 
.v-meta {
  margin-top: 0.5rem;
  color: rgba(0,0,0,0.6);
  font-style: italic;
  text-align: left;
  line-height: 1.4;
}

.dark .v-meta {
  color: rgba(255,255,255,0.6);
}

 
@media (max-width: 768px) {
  .v-main {
    flex-direction: column;
    gap: 1.25rem;
    align-items: center;
    min-height: auto;
  }
  
  .v-controls-right {
    align-items: center;
    text-align: center;
  }
  
  .v-meta {
    text-align: center;
  }
  
   
  .v-card {
    width: 6rem;
    height: 8rem;
  }
}

@media (min-width: 769px) and (max-width: 1024px) {
  .v-main {
    gap: 1rem;
  }
}
</style>

<script>
 
(function(){
  const TAROT = [
    {name: "愚者 (The Fool)", meaning: "新的开始、信心与冒险。"},
    {name: "魔术师 (The Magician)", meaning: "行动力、资源与创造力。"},
    {name: "女祭司 (The High Priestess)", meaning: "直觉、潜意识与等待时机。"},
    {name: "女皇 (The Empress)", meaning: "丰饶、养育与创作。"},
    {name: "皇帝 (The Emperor)", meaning: "秩序、权威与结构。"},
    {name: "教皇 (The Hierophant)", meaning: "传统、学习与指引。"},
    {name: "恋人 (The Lovers)", meaning: "关系、选择与价值观。"},
    {name: "战车 (The Chariot)", meaning: "意志、胜利与掌控。"},
    {name: "力量 (Strength)", meaning: "勇气、温柔的力量与自制。"},
    {name: "隐士 (The Hermit)", meaning: "内省、寻找答案与独处。"},
    {name: "命运之轮 (Wheel of Fortune)", meaning: "变动、周期与机遇。"},
    {name: "正义 (Justice)", meaning: "平衡、因果与公平。"},
    {name: "倒吊人 (The Hanged Man)", meaning: "换位思考、暂停与牺牲。"},
    {name: "死神 (Death)", meaning: "终结与新生（象征转变）。"},
    {name: "节制 (Temperance)", meaning: "平衡、和谐与耐心。"},
    {name: "恶魔 (The Devil)", meaning: "束缚、诱惑与觉察。"},
    {name: "高塔 (The Tower)", meaning: "突发变故、真相与重建。"},
    {name: "星星 (The Star)", meaning: "希望、疗愈与灵感。"},
    {name: "月亮 (The Moon)", meaning: "潜意识、迷惑与直觉。"},
    {name: "太阳 (The Sun)", meaning: "成功、喜悦与清晰。"},
    {name: "审判 (Judgement)", meaning: "觉醒、评估与重生。"},
    {name: "世界 (The World)", meaning: "完成、成就与圆满。"}
  ];

  const KEY = 'hugo_tarot_draw_vintage_v1_minimal';

  
  const card = document.getElementById('v-tarot-card');
  const drawBtn = document.getElementById('v-draw-btn');
  const nameEl = document.getElementById('v-card-name');
  const meaningEl = document.getElementById('v-card-meaning');
  const metaResult = document.getElementById('v-meta-result');
  const metaNext = document.getElementById('v-meta-next');

  function localDateStr(d = new Date()){
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${dd}`;
  }
  function nextDateStr(d = new Date()){
    const t = new Date(d);
    t.setDate(t.getDate() + 1);
    return localDateStr(t);
  }

  function loadRecord(){
    try {
      const raw = localStorage.getItem(KEY);
      return raw ? JSON.parse(raw) : null;
    } catch(e) { return null; }
  }
  function saveRecord(date, idx){
    localStorage.setItem(KEY, JSON.stringify({date, idx}));
  }

  function showCard(idx){
    const t = TAROT[idx];
    nameEl.textContent = t.name;
    meaningEl.textContent = t.meaning;
    card.classList.add('is-flipped');
  }
  function hideCard(){
    card.classList.remove('is-flipped');
    nameEl.textContent = '点击抽牌';
    meaningEl.textContent = '每日一则简短指引';
  }

  function init(){
    const rec = loadRecord();
    const today = localDateStr();
    if(rec && rec.date === today && typeof rec.idx === 'number'){
      showCard(rec.idx);
      drawBtn.disabled = true;
      drawBtn.textContent = '今日已抽取';
      metaResult.textContent = `你今天已抽：${TAROT[rec.idx].name}。`;
      metaNext.textContent = `下次可抽：${nextDateStr(new Date())}`;
    } else {
      hideCard();
      drawBtn.disabled = false;
      drawBtn.textContent = '抽取今日塔罗';
      metaResult.textContent = '每天一次 · 基于本地时区。';
      metaNext.textContent = '';
    }
  }

  function draw(){
    const rec = loadRecord();
    const today = localDateStr();
    if(rec && rec.date === today){
      drawBtn.disabled = true;
      drawBtn.textContent = '今日已抽取';
      metaResult.textContent = `你今天已抽：${TAROT[rec.idx].name}。`;
      metaNext.textContent = `下次可抽：${nextDateStr(new Date())}`;
      return;
    }
    const idx = Math.floor(Math.random() * TAROT.length);
    saveRecord(today, idx);
    showCard(idx);
    drawBtn.disabled = true;
    drawBtn.textContent = '今日已抽取';
    metaResult.textContent = `你抽到：${TAROT[idx].name}。`;
    metaNext.textContent = `属灵日期：${today}`;
    
    try {
      card.animate([{opacity:0.97},{opacity:1}], {duration:300, easing:'ease-out'});
    } catch(e){}
  }

  
  drawBtn.addEventListener('click', draw);
  card.addEventListener('click', function(){
    const rec = loadRecord();
    const today = localDateStr();
    if(rec && rec.date === today) return;
    draw();
  });
  card.addEventListener('keydown', function(e){
    if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); card.click(); }
  });

  
  init();
})();
</script>

      </div>
    
  
</div>






<div class="mt-8">
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-start">
    
    <div class="lg:col-span-1">
      <div id="site-search" class="mx-3 my-3" style="max-width:24rem; width:100%;">
  
  <label for="search-input" class="search-label" style="display:block; margin-bottom:0.35rem; font-size:0.95rem;">
    搜索本站文章
  </label>

  <div class="relative">
    <input
      id="search-input"
      type="search"
      placeholder="搜索文章 / 标题 / 标签…"
      aria-label="搜索本站文章"
      autocomplete="off"
      class="w-full p-2 rounded border-0 border-b border-gray-200 text-base focus:outline-none"
      style="border-bottom-width:1px; border-color:var(--search-border-color);"
      disabled
    />
  </div>

  <div id="search-results" class="mt-2 w-full" role="list" aria-live="polite"></div>
</div>

<script>
 
(async function () {
  const INDEX_URL = '\/index.json';
  const input = document.getElementById('search-input');
  const resultsEl = document.getElementById('search-results');

  let fuse = null;
  let data = [];

  function loadScript(src) {
    return new Promise((resolve, reject) => {
      if (window.Fuse) return resolve();
      const s = document.createElement('script');
      s.src = src;
      s.async = true;
      s.onload = () => resolve();
      s.onerror = () => reject(new Error('加载脚本失败: ' + src));
      document.head.appendChild(s);
    });
  }

  try {
    const res = await fetch(INDEX_URL, { cache: 'no-store' });
    if (!res.ok) throw new Error(`索引读取失败（HTTP ${res.status}）`);
    data = await res.json();
    console.debug('[search] index.json 已加载，条目数:', Array.isArray(data) ? data.length : '(非数组)');
  } catch (err) {
    console.error('[search] 无法读取 index.json:', err);
    input.disabled = true;
    return;
  }

  try {
    if (!window.Fuse) {
      await loadScript('https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js');
      console.debug('[search] Fuse.js 已加载');
    }
  } catch (err) {
    console.error('[search] 加载 Fuse.js 失败:', err);
    input.disabled = true;
    return;
  }

  try {
    fuse = new Fuse(data, {
      keys: [
        { name: "title", weight: 0.7 },
        { name: "tags", weight: 0.5 },
        { name: "summary", weight: 0.3 },
        { name: "content", weight: 0.2 }
      ],
      includeMatches: true,
      threshold: 0.32,
      minMatchCharLength: 2,
    });
    console.debug('[search] Fuse 初始化完成');
    input.disabled = false;
  } catch (err) {
    console.error('[search] 初始化 Fuse 失败:', err);
    input.disabled = true;
    return;
  }

  let debounceTimer = null;
  input.addEventListener('input', (e) => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      const q = e.target.value.trim();
      if (!q) {
        resultsEl.innerHTML = '';
        return;
      }
      doSearch(q);
    }, 160);
  });

  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      const first = resultsEl.querySelector('a');
      if (first) window.location.href = first.href;
    }
  });

  function doSearch(query) {
    if (!fuse) return;
    try {
      const hits = fuse.search(query, { limit: 10 }) || [];
      if (hits.length === 0) {
        resultsEl.innerHTML = '<p class="text-gray-500 text-sm p-2">未找到结果</p>';
        return;
      }
      resultsEl.innerHTML = hits.map(renderHit).join('');
    } catch (err) {
      console.error('[search] 搜索错误:', err);
      resultsEl.innerHTML = '<p class="text-gray-500 text-sm p-2">搜索时出错（查看控制台）</p>';
    }
  }

  function highlightUsingMatches(text, matchesArray) {
    if (!text) return '';
    if (!matchesArray || matchesArray.length === 0) return escapeHtml(truncate(text, 200));
    try {
      const firstRange = Array.isArray(matchesArray[0][0]) ? matchesArray[0][0] : matchesArray[0];
      const start = Math.max(0, firstRange[0]);
      const end = Math.min(text.length - 1, firstRange[1]);
      const before = escapeHtml(text.slice(0, start));
      const match = escapeHtml(text.slice(start, end + 1));
      const after = escapeHtml(text.slice(end + 1));
      return truncate(before, 60) + '<mark class="search-mark">' + match + '</mark>' + truncate(after, 120);
    } catch (e) {
      return escapeHtml(truncate(text, 200));
    }
  }

  function renderHit(hit) {
    const item = hit.item || hit;
    const title = item.title || 'Untitled';
    const url = item.url || '#';
    const date = item.date ? (new Date(item.date)).toLocaleDateString() : '';
    let titleMatches = null, summaryMatches = null;
    if (hit.matches && Array.isArray(hit.matches)) {
      for (const m of hit.matches) {
        if (m.key === 'title') titleMatches = m.indices;
        if (m.key === 'summary' || m.key === 'content') summaryMatches = m.indices;
      }
    }
    const titleHtml = highlightUsingMatches(title, titleMatches);
    const summaryText = item.summary || item.content || '';
    const summaryHtml = highlightUsingMatches(truncate(summaryText, 220), summaryMatches);

    return `
      <article class="search-hit border-b border-gray-100 py-2">
        <a href="${url}" class="block p-2 no-underline transition duration-100 hover:bg-gray-100">
          <h3 class="text-base" style="margin:0; color:var(--search-title-color);">${titleHtml}</h3>
          <div class="text-xs" style="margin-top:6px; color:var(--search-date-color);">${escapeHtml(date)}</div>
          <p class="text-sm" style="margin:0.4rem 0 0; color:var(--search-summary-color);">${summaryHtml}</p>
        </a>
      </article>
    `;
  }

  function escapeHtml(s) {
    if (!s) return '';
    return String(s).replace(/[&<>"']/g, function (m) {
      return ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]);
    });
  }
  function truncate(s, n) {
    if (!s) return '';
    return s.length > n ? s.slice(0, n) + '…' : s;
  }

})();
</script>

<style>
:root {
  --search-input-color: #111827;
  --search-placeholder-color: #9ca3af;
  --search-border-color: #e5e7eb;
  --search-result-bg-hover: #f8fafc;
  --search-title-color: #111827;
  --search-summary-color: #374151;
  --search-date-color: #6b7280;
  --search-mark-bg: #fff2b0;
  --search-label-color: #374151;
}

 
.dark :root,
.dark {
  --search-input-color: #e5e7eb;
  --search-placeholder-color: #9ca3af;
  --search-border-color: #3A3A3A;
  --search-result-bg-hover: rgba(255,255,255,0.03);
  --search-title-color: #e5e7eb;
  --search-summary-color: #d1d5db;
  --search-date-color: #9ca3af;
  --search-mark-bg: #5b3b00;
  --search-label-color: #d1d5db;
}

 
.search-label {
  color: var(--search-label-color);
  font-weight: 600;
}

 
#site-search input {
  background: transparent;
  border-radius: 6px;
  border: 0;
  border-bottom: 1px solid var(--search-border-color);
  padding: 0.5rem 0.6rem;
  font-size: 1rem;
  color: var(--search-input-color);
  outline: none;
}

#site-search input::placeholder {
  color: var(--search-placeholder-color);
}

 
#search-results {
  background: transparent;
  margin-top: 0.25rem;
}

.search-hit a {
  color: inherit;
  display: block;
  border-radius: 6px;
  text-decoration: none;
}

.search-hit a:hover {
  background: var(--search-result-bg-hover);
}

.search-hit h3 { line-height: 1.2; color: var(--search-title-color); }
.search-hit p { color: var(--search-summary-color); }
.search-hit .text-xs { color: var(--search-date-color); }

 
.search-mark {
  background: var(--search-mark-bg);
  padding: 0 2px;
  border-radius: 2px;
  color: inherit;
}

 
#site-search input[type="search"]::-webkit-search-cancel-button {
  -webkit-appearance: none;
  appearance: none;
  height: 16px;
  width: 16px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='18' y1='6' x2='6' y2='18'%3E%3C/line%3E%3Cline x1='6' y1='6' x2='18' y2='18'%3E%3C/line%3E%3C/svg%3E");
  background-size: 16px 16px;
  background-repeat: no-repeat;
  background-position: center;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.2s;
}

</style>


    </div>
    
    
    <div class="lg:col-span-1 flex flex-col items-center">
      <div class="home-banners">
  
  
  
  <div class="banner-item">
    <a href="/posts/links/" class="banner-link">
      <img src="/img/a.webp" alt="" class="banner-image">
      <div class="banner-overlay">
        <h3></h3>
        
      </div>
    </a>
  </div>
  
  <div class="banner-item">
    <a href="/posts/guestbook/" class="banner-link">
      <img src="/img/b.webp" alt="" class="banner-image">
      <div class="banner-overlay">
        <h3></h3>
        
      </div>
    </a>
  </div>
  
</div>
    </div>
  </div>
</div>


        </div><footer class="bg-rose text-white dark:bg-warmgray-900 dark:text-white pt-5 pb-5" style="font-family: 'title'">
  <div class="container mx-auto px-4">
    <p>&copy; <a href="http://localhost:1313/" class="hover:text-gray-500 duration-200">结痂行会</a></p>
  </div>
</footer>
<script>
  function toggleNav() {
      var hamburger = document.getElementById("hamburgerbtn");
      var overlay = document.getElementById("overlay");
      var body = document.body;

      hamburger.addEventListener("click", function () {
          overlay.classList.toggle("open");
          hamburger.classList.toggle("is-open");
          body.classList.toggle("scroll-lock");
      });
  }
  toggleNav();

  var icon = document.getElementById("icon");
  if (document.documentElement.classList.contains("dark") || localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      icon.classList.remove("icon-moon");
      icon.classList.add("icon-sun");
      document.documentElement.classList.add('dark')
  } else {
      document.documentElement.classList.remove('dark')
  }
  function toggleDarkMode() {
    if (document.documentElement.classList.contains('dark')) {
      icon.classList.remove("icon-sun");
      icon.classList.add("icon-moon");
      document.documentElement.classList.remove('dark')
      localStorage.theme = 'light'
    } else {
      icon.classList.remove("icon-moon");
      icon.classList.add("icon-sun");
      document.documentElement.classList.add('dark')
      localStorage.theme = 'dark'
    }
  }
</script>

</body>
</html>

